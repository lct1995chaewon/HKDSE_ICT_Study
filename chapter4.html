<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第四課：試算表 - 互動溫習</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        
        .font-chinese {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-success {
            animation: pulseSuccess 0.6s ease-in-out;
        }
        
        .pulse-error {
            animation: pulseError 0.6s ease-in-out;
        }
        
        @keyframes pulseSuccess {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); background-color: #10b981; }
        }
        
        @keyframes pulseError {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); background-color: #ef4444; }
        }

        .converter-card {
            transition: all 0.3s ease;
        }
        
        .converter-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .format-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .format-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px -5px rgba(0, 0, 0, 0.15);
        }

        .cell-grid {
            display: grid;
            grid-template-columns: 30px repeat(10, 60px);
            grid-template-rows: 30px repeat(10, 30px);
            gap: 1px;
            background-color: #e5e7eb;
            border: 2px solid #9ca3af;
        }
        
        .cell {
            background-color: white;
            border: 1px solid #d1d5db;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .cell:hover {
            background-color: #dbeafe;
        }
        
        .cell.selected {
            background-color: #3b82f6;
            color: white;
        }
        
        .cell.header {
            background-color: #f3f4f6;
            font-weight: bold;
            cursor: default;
        }
    </style>
</head>
<body class="font-chinese bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">
    <!-- Header -->
    <header class="bg-gradient-to-r from-purple-600 to-blue-600 text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl md:text-4xl font-bold text-center">新界喇沙中學 資訊及通訊科技科</h1>
            <p class="text-center text-xl mt-2 opacity-90">第四課：試算表 - 互動溫習</p>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center space-x-2 md:space-x-4 py-3">
                <button onclick="showSection('overview')" class="nav-btn px-3 py-2 rounded-lg text-sm md:text-base font-medium transition-colors duration-200 bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300">概覽</button>
                <button onclick="showSection('basics')" class="nav-btn px-3 py-2 rounded-lg text-sm md:text-base font-medium transition-colors duration-200 hover:bg-purple-100 dark:hover:bg-purple-900">基礎操作</button>
                <button onclick="showSection('formulas')" class="nav-btn px-3 py-2 rounded-lg text-sm md:text-base font-medium transition-colors duration-200 hover:bg-purple-100 dark:hover:bg-purple-900">公式函數</button>
                <button onclick="showSection('references')" class="nav-btn px-3 py-2 rounded-lg text-sm md:text-base font-medium transition-colors duration-200 hover:bg-purple-100 dark:hover:bg-purple-900">儲存格參照</button>
                <button onclick="showSection('datamanip')" class="nav-btn px-3 py-2 rounded-lg text-sm md:text-base font-medium transition-colors duration-200 hover:bg-purple-100 dark:hover:bg-purple-900">數據處理</button>
                <button onclick="showSection('charts')" class="nav-btn px-3 py-2 rounded-lg text-sm md:text-base font-medium transition-colors duration-200 hover:bg-purple-100 dark:hover:bg-purple-900">圖表分析</button>
                <button onclick="showSection('quiz')" class="nav-btn px-3 py-2 rounded-lg text-sm md:text-base font-medium transition-colors duration-200 hover:bg-purple-100 dark:hover:bg-purple-900">測驗</button>
            </div>
        </div>
    </nav>

    <!-- Progress Bar -->
    <div class="bg-gray-200 dark:bg-gray-700 h-2">
        <div id="progressBar" class="bg-gradient-to-r from-purple-500 to-blue-500 h-2 transition-all duration-300" style="width: 0%"></div>
    </div>

    <!-- 懸浮返回主頁按鈕 -->
    <a href="index.html" class="fixed bottom-6 right-6 bg-gradient-to-r from-purple-500 to-blue-500 text-white p-4 rounded-full shadow-lg hover:from-purple-600 hover:to-blue-600 transition-all duration-300 transform hover:scale-110 z-50 flex items-center justify-center">
        <span class="text-2xl">🏠</span>
    </a>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Overview Section -->
        <section id="overview" class="section fade-in">
            <div class="bg-gradient-to-br from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 md:p-8 shadow-lg">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center">📊 課程概覽</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-md">
                        <h3 class="text-xl font-semibold mb-4 text-purple-600 dark:text-purple-400">🎯 學習目標</h3>
                        <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                            <li>• 掌握試算表軟件的基本操作</li>
                            <li>• 學習儲存格格式和編輯技巧</li>
                            <li>• 理解公式和函數的應用</li>
                            <li>• 掌握儲存格參照的類型</li>
                            <li>• 學習數據處理和分析技巧</li>
                            <li>• 了解圖表製作和數據視覺化</li>
                        </ul>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-md">
                        <h3 class="text-xl font-semibold mb-4 text-blue-600 dark:text-blue-400">📚 主要概念</h3>
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3">
                                <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                                <span>工作表、儲存格和位址</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                                <span>公式和函數運算</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <span class="w-3 h-3 bg-purple-500 rounded-full"></span>
                                <span>相對與絕對參照</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <span class="w-3 h-3 bg-orange-500 rounded-full"></span>
                                <span>數據分析與圖表</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg p-6 shadow-md">
                    <h3 class="text-xl font-semibold mb-4 text-orange-600 dark:text-orange-400">💡 重要提醒</h3>
                    <div class="bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-500 p-4 rounded">
                        <p class="text-gray-700 dark:text-gray-300">
                            <strong>試算表</strong>是處理數據的重要工具，要熟練掌握公式構建、函數應用和數據分析技巧。
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Basics Section -->
        <section id="basics" class="section hidden">
            <div class="bg-gradient-to-br from-green-50 to-teal-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 md:p-8 shadow-lg">
                <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">📋 基礎操作</h2>
                
                <!-- 工作表介面 -->
                <div class="mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-green-600 dark:text-green-400">🖥️ 工作表介面</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-4 text-lg">儲存格位址系統</h4>
                            <div class="space-y-3 text-sm">
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
                                    <strong>欄位標識：</strong> A, B, C, D... (字母)
                                </div>
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded">
                                    <strong>列位標識：</strong> 1, 2, 3, 4... (數字)
                                </div>
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded">
                                    <strong>儲存格位址：</strong> 欄字母 + 列數字<br>
                                    例如：A1, B4, C10
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-teal-600 dark:text-teal-400 mb-4 text-lg">互動工作表</h4>
                            <div class="cell-grid text-xs">
                                <div class="cell header"></div>
                                <div class="cell header">A</div>
                                <div class="cell header">B</div>
                                <div class="cell header">C</div>
                                <div class="cell header">D</div>
                                <div class="cell header">E</div>
                                <div class="cell header">F</div>
                                <div class="cell header">G</div>
                                <div class="cell header">H</div>
                                <div class="cell header">I</div>
                                <div class="cell header">J</div>
                                
                                <div class="cell header">1</div>
                                <div class="cell" onclick="selectCell(this, 'A1')"></div>
                                <div class="cell" onclick="selectCell(this, 'B1')"></div>
                                <div class="cell" onclick="selectCell(this, 'C1')"></div>
                                <div class="cell" onclick="selectCell(this, 'D1')"></div>
                                <div class="cell" onclick="selectCell(this, 'E1')"></div>
                                <div class="cell" onclick="selectCell(this, 'F1')"></div>
                                <div class="cell" onclick="selectCell(this, 'G1')"></div>
                                <div class="cell" onclick="selectCell(this, 'H1')"></div>
                                <div class="cell" onclick="selectCell(this, 'I1')"></div>
                                <div class="cell" onclick="selectCell(this, 'J1')"></div>
                                
                                <div class="cell header">2</div>
                                <div class="cell" onclick="selectCell(this, 'A2')"></div>
                                <div class="cell" onclick="selectCell(this, 'B2')"></div>
                                <div class="cell" onclick="selectCell(this, 'C2')"></div>
                                <div class="cell" onclick="selectCell(this, 'D2')"></div>
                                <div class="cell" onclick="selectCell(this, 'E2')"></div>
                                <div class="cell" onclick="selectCell(this, 'F2')"></div>
                                <div class="cell" onclick="selectCell(this, 'G2')"></div>
                                <div class="cell" onclick="selectCell(this, 'H2')"></div>
                                <div class="cell" onclick="selectCell(this, 'I2')"></div>
                                <div class="cell" onclick="selectCell(this, 'J2')"></div>
                                
                                <div class="cell header">3</div>
                                <div class="cell" onclick="selectCell(this, 'A3')"></div>
                                <div class="cell" onclick="selectCell(this, 'B3')"></div>
                                <div class="cell" onclick="selectCell(this, 'C3')"></div>
                                <div class="cell" onclick="selectCell(this, 'D3')"></div>
                                <div class="cell" onclick="selectCell(this, 'E3')"></div>
                                <div class="cell" onclick="selectCell(this, 'F3')"></div>
                                <div class="cell" onclick="selectCell(this, 'G3')"></div>
                                <div class="cell" onclick="selectCell(this, 'H3')"></div>
                                <div class="cell" onclick="selectCell(this, 'I3')"></div>
                                <div class="cell" onclick="selectCell(this, 'J3')"></div>
                                
                                <div class="cell header">4</div>
                                <div class="cell" onclick="selectCell(this, 'A4')"></div>
                                <div class="cell" onclick="selectCell(this, 'B4')"></div>
                                <div class="cell" onclick="selectCell(this, 'C4')"></div>
                                <div class="cell" onclick="selectCell(this, 'D4')"></div>
                                <div class="cell" onclick="selectCell(this, 'E4')"></div>
                                <div class="cell" onclick="selectCell(this, 'F4')"></div>
                                <div class="cell" onclick="selectCell(this, 'G4')"></div>
                                <div class="cell" onclick="selectCell(this, 'H4')"></div>
                                <div class="cell" onclick="selectCell(this, 'I4')"></div>
                                <div class="cell" onclick="selectCell(this, 'J4')"></div>
                                
                                <div class="cell header">5</div>
                                <div class="cell" onclick="selectCell(this, 'A5')"></div>
                                <div class="cell" onclick="selectCell(this, 'B5')"></div>
                                <div class="cell" onclick="selectCell(this, 'C5')"></div>
                                <div class="cell" onclick="selectCell(this, 'D5')"></div>
                                <div class="cell" onclick="selectCell(this, 'E5')"></div>
                                <div class="cell" onclick="selectCell(this, 'F5')"></div>
                                <div class="cell" onclick="selectCell(this, 'G5')"></div>
                                <div class="cell" onclick="selectCell(this, 'H5')"></div>
                                <div class="cell" onclick="selectCell(this, 'I5')"></div>
                                <div class="cell" onclick="selectCell(this, 'J5')"></div>
                            </div>
                            <div class="mt-3 text-sm text-gray-600 dark:text-gray-400">
                                <strong>選中的儲存格：</strong> <span id="selectedCell">無</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 數據格式 -->
                <div class="mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-teal-600 dark:text-teal-400">📝 數據格式</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-purple-600 dark:text-purple-400 mb-4 text-lg">數值格式類型</h4>
                            <div class="space-y-3 text-sm">
                                <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded flex justify-between">
                                    <strong>通用格式</strong>
                                    <span>123</span>
                                </div>
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded flex justify-between">
                                    <strong>數值</strong>
                                    <span>123.45</span>
                                </div>
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded flex justify-between">
                                    <strong>貨幣</strong>
                                    <span>$123.45</span>
                                </div>
                                <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded flex justify-between">
                                    <strong>百分比</strong>
                                    <span>12.34%</span>
                                </div>
                                <div class="p-3 bg-red-50 dark:bg-red-900/20 rounded flex justify-between">
                                    <strong>日期</strong>
                                    <span>2024/12/01</span>
                                </div>
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded flex justify-between">
                                    <strong>文字</strong>
                                    <span>001 (保留前導零)</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-orange-600 dark:text-orange-400 mb-4 text-lg">格式化功能</h4>
                            <div class="space-y-4">
                                <div class="p-3 bg-orange-50 dark:bg-orange-900/20 rounded">
                                    <strong>自動換列：</strong>當文字超出儲存格寬度時自動換行
                                </div>
                                <div class="p-3 bg-cyan-50 dark:bg-cyan-900/20 rounded">
                                    <strong>跨欄置中：</strong>合併多個儲存格並將內容置中
                                </div>
                                <div class="p-3 bg-pink-50 dark:bg-pink-900/20 rounded">
                                    <strong>調整欄寬/列高：</strong>改變儲存格的尺寸
                                </div>
                                <div class="p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded">
                                    <strong>表格樣式：</strong>套用預設的表格設計主題
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 編輯技巧 -->
                <div>
                    <h3 class="text-2xl font-semibold mb-6 text-green-600 dark:text-green-400">🛠️ 編輯技巧</h3>
                    <div class="grid lg:grid-cols-3 gap-6">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-4 text-lg">凍結窗格</h4>
                            <div class="space-y-3 text-sm">
                                <p class="text-gray-700 dark:text-gray-300">
                                    保持重要的行或列在滾動時始終可見
                                </p>
                                <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded">
                                    <strong>用途：</strong><br>
                                    • 表格標題行<br>
                                    • 重要參考欄<br>
                                    • 方便大表格瀏覽
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-green-600 dark:text-green-400 mb-4 text-lg">自動填滿</h4>
                            <div class="space-y-3 text-sm">
                                <p class="text-gray-700 dark:text-gray-300">
                                    快速填充相鄰儲存格的數據
                                </p>
                                <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded">
                                    <strong>方式：</strong><br>
                                    • 複製儲存格內容<br>
                                    • 數列方式填滿<br>
                                    • 節省輸入時間
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-purple-600 dark:text-purple-400 mb-4 text-lg">格式檢測器</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">輸入數值：</label>
                                    <input id="formatInput" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="例如：001, 123.45, 12/25">
                                    <button onclick="detectFormat()" class="mt-2 w-full px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors duration-200">
                                        檢測格式
                                    </button>
                                </div>
                                <div id="formatResult" class="hidden p-4 rounded-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Formulas Section -->
        <section id="formulas" class="section hidden">
            <div class="bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 md:p-8 shadow-lg">
                <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">🧮 公式與函數</h2>
                
                <!-- 公式基礎 -->
                <div class="mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-orange-600 dark:text-orange-400">⚡ 公式基礎</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-blue-500">
                            <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-4 text-lg">公式組成要素</h4>
                            <div class="space-y-3 text-sm">
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
                                    <strong>1. 常數：</strong>數字、字串、布爾值<br>
                                    例如：123, "文字", TRUE
                                </div>
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded">
                                    <strong>2. 運算符：</strong>算術、比較、文字串連<br>
                                    例如：+, -, *, /, >, <, &
                                </div>
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded">
                                    <strong>3. 儲存格參照：</strong>單一或範圍<br>
                                    例如：A1, B2:D5
                                </div>
                                <div class="p-3 bg-orange-50 dark:bg-orange-900/20 rounded">
                                    <strong>4. 函數：</strong>預定義的計算<br>
                                    例如：SUM(), AVERAGE(), IF()
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-green-500">
                            <h4 class="font-semibold text-green-600 dark:text-green-400 mb-4 text-lg">運算符類型</h4>
                            <div class="space-y-4">
                                <div>
                                    <strong class="text-red-600 dark:text-red-400">算術運算符：</strong>
                                    <div class="grid grid-cols-2 gap-2 mt-2 text-sm font-mono">
                                        <span>+ (加法)</span><span>- (減法)</span>
                                        <span>* (乘法)</span><span>/ (除法)</span>
                                        <span>^ (次方)</span><span>% (百分比)</span>
                                    </div>
                                </div>
                                <div>
                                    <strong class="text-blue-600 dark:text-blue-400">比較運算符：</strong>
                                    <div class="grid grid-cols-2 gap-2 mt-2 text-sm font-mono">
                                        <span>= (等於)</span><span><> (不等於)</span>
                                        <span>> (大於)</span><span>< (小於)</span>
                                        <span>>= (大於等於)</span><span><= (小於等於)</span>
                                    </div>
                                </div>
                                <div>
                                    <strong class="text-purple-600 dark:text-purple-400">文字串連：</strong>
                                    <div class="mt-2 text-sm font-mono">
                                        & (連接文字)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DSE 公式速查表 -->
                <div class="mb-12">
                    <div class="bg-gradient-to-r from-red-100 to-orange-100 dark:from-red-900/30 dark:to-orange-900/30 p-6 rounded-xl mb-8 border-2 border-red-200 dark:border-red-600">
                        <h3 class="text-2xl font-semibold text-red-700 dark:text-red-300 mb-4 text-center">🎯 DSE 公式速查表</h3>
                        <p class="text-gray-700 dark:text-gray-300 text-center text-lg">
                            香港DSE資訊及通訊科技科 - 試算表考試範圍
                        </p>
                    </div>

                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border-l-4 border-red-500">
                            <h4 class="font-bold text-red-600 dark:text-red-400 mb-4 text-xl">基本元素</h4>
                            
                            <div class="mb-6">
                                <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg mb-4">
                                    <h5 class="font-semibold mb-3 text-red-700 dark:text-red-300">🔢 常數</h5>
                                    <div class="grid grid-cols-2 gap-2 text-sm font-mono">
                                        <span class="p-2 bg-white dark:bg-gray-700 rounded">TRUE</span>
                                        <span class="p-2 bg-white dark:bg-gray-700 rounded">FALSE</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg">
                                <h5 class="font-semibold text-red-700 dark:text-red-300 mb-3">⚡ 運算符</h5>
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div>
                                        <strong>算術：</strong>
                                        <div class="font-mono space-x-2 mt-1">
                                            <span class="bg-white dark:bg-gray-700 px-2 py-1 rounded">+</span>
                                            <span class="bg-white dark:bg-gray-700 px-2 py-1 rounded">-</span>
                                            <span class="bg-white dark:bg-gray-700 px-2 py-1 rounded">*</span>
                                            <span class="bg-white dark:bg-gray-700 px-2 py-1 rounded">/</span>
                                        </div>
                                    </div>
                                    <div>
                                        <strong>比較：</strong>
                                        <div class="font-mono space-x-1 mt-1">
                                            <span class="bg-white dark:bg-gray-700 px-1 py-1 rounded text-xs">&lt;</span>
                                            <span class="bg-white dark:bg-gray-700 px-1 py-1 rounded text-xs">&gt;</span>
                                            <span class="bg-white dark:bg-gray-700 px-1 py-1 rounded text-xs">=</span>
                                            <span class="bg-white dark:bg-gray-700 px-1 py-1 rounded text-xs">&lt;&gt;</span>
                                            <span class="bg-white dark:bg-gray-700 px-1 py-1 rounded text-xs">&lt;=</span>
                                            <span class="bg-white dark:bg-gray-700 px-1 py-1 rounded text-xs">&gt;=</span>
                                        </div>
                                    </div>
                                    <div class="col-span-2">
                                        <strong>文字串連：</strong>
                                        <span class="bg-white dark:bg-gray-700 px-2 py-1 rounded font-mono ml-2">&</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                            <h4 class="font-bold text-blue-600 dark:text-blue-400 mb-4 text-xl">DSE 考試函數 (21個)</h4>
                            
                            <div class="space-y-4 text-sm">
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
                                    <strong class="text-red-600 dark:text-red-400">數學計算 (7個)：</strong>
                                    <div class="mt-2 space-y-1 font-mono text-xs">
                                        <div>INT(數字) - 取整數部分</div>
                                        <div>RAND() - 生成0-1隨機數</div>
                                        <div>SQRT(數字) - 平方根</div>
                                        <div>ROUND(數字,位數) - 四捨五入</div>
                                        <div>SUM(範圍) - 求和</div>
                                        <div>AVERAGE(範圍) - 平均值</div>
                                        <div>SUMIF(範圍,條件,求和範圍) - 條件求和</div>
                                    </div>
                                </div>
                                
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded">
                                    <strong class="text-green-600 dark:text-green-400">邏輯判斷 (4個)：</strong>
                                    <div class="mt-2 space-y-1 font-mono text-xs">
                                        <div>IF(條件,真值,假值) - 條件判斷</div>
                                        <div>AND(條件1,條件2,...) - 邏輯與</div>
                                        <div>OR(條件1,條件2,...) - 邏輯或</div>
                                        <div>NOT(條件) - 邏輯非</div>
                                    </div>
                                </div>
                                
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded">
                                    <strong class="text-purple-600 dark:text-purple-400">文字處理 (5個)：</strong>
                                    <div class="mt-2 space-y-1 font-mono text-xs">
                                        <div>LEFT(文字,字數) - 取左邊字符</div>
                                        <div>RIGHT(文字,字數) - 取右邊字符</div>
                                        <div>MID(文字,起始,字數) - 取中間字符</div>
                                        <div>LEN(文字) - 計算字符長度</div>
                                        <div>FIND(子字串,文字) - 查找字符位置</div>
                                    </div>
                                </div>
                                
                                <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded">
                                    <strong class="text-yellow-600 dark:text-yellow-400">統計分析 (5個)：</strong>
                                    <div class="mt-2 space-y-1 font-mono text-xs">
                                        <div>COUNT(範圍) - 計算數字個數</div>
                                        <div>COUNTIF(範圍,條件) - 條件計數</div>
                                        <div>MAX(範圍) - 最大值</div>
                                        <div>MIN(範圍) - 最小值</div>
                                        <div>RANK(數字,範圍) - 排名</div>
                                    </div>
                                </div>
                                
                                <div class="p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded">
                                    <strong class="text-indigo-600 dark:text-indigo-400">查找函數 (1個)：</strong>
                                    <div class="mt-2 font-mono text-xs">
                                        <div>XLOOKUP(查找值,查找範圍,返回範圍) - 查找</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 p-6 rounded-xl">
                        <div class="flex items-start space-x-3">
                            <span class="text-2xl">⚠️</span>
                            <div>
                                <h5 class="font-bold text-yellow-700 dark:text-yellow-300 mb-2">DSE 考試重要提醒</h5>
                                <ul class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
                                    <li>• 只有以上21個函數會在DSE考試中出現</li>
                                    <li>• VLOOKUP、HLOOKUP已被XLOOKUP取代</li>
                                    <li>• 所有函數名稱和語法必須準確記憶</li>
                                    <li>• 重點掌握IF、SUMIF、COUNTIF、XLOOKUP的應用</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 函數分類詳解 -->
                <div class="mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-yellow-600 dark:text-yellow-400">📚 DSE函數詳解</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-red-600 dark:text-red-400 mb-4 text-lg">🧮 數學函數</h4>
                            <div class="space-y-2 text-sm">
                                <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded font-mono">SUM(A1:A10) - 求和</div>
                                <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded font-mono">AVERAGE(B1:B5) - 平均值</div>
                                <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded font-mono">MAX(C1:C20) - 最大值</div>
                                <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded font-mono">MIN(D1:D15) - 最小值</div>
                                <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded font-mono">ROUND(E1,2) - 四捨五入</div>
                                <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded font-mono">INT(F1) - 取整數</div>
                                <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded font-mono">SQRT(G1) - 平方根</div>
                                <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded font-mono">RAND() - 隨機數</div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-4 text-lg">🎯 邏輯函數</h4>
                            <div class="space-y-2 text-sm">
                                <div class="p-2 bg-blue-50 dark:bg-blue-900/20 rounded font-mono">IF(A1>5,"Pass","Fail")</div>
                                <div class="p-2 bg-blue-50 dark:bg-blue-900/20 rounded font-mono">AND(B1>0,C1<100)</div>
                                <div class="p-2 bg-blue-50 dark:bg-blue-900/20 rounded font-mono">OR(D1="A",D1="B")</div>
                                <div class="p-2 bg-blue-50 dark:bg-blue-900/20 rounded font-mono">NOT(E1=FALSE)</div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-green-600 dark:text-green-400 mb-4 text-lg">📝 文字函數</h4>
                            <div class="space-y-2 text-sm">
                                <div class="p-2 bg-green-50 dark:bg-green-900/20 rounded font-mono">LEFT(A1,3) - 左邊3字符</div>
                                <div class="p-2 bg-green-50 dark:bg-green-900/20 rounded font-mono">RIGHT(B1,2) - 右邊2字符</div>
                                <div class="p-2 bg-green-50 dark:bg-green-900/20 rounded font-mono">MID(C1,2,5) - 中間字符</div>
                                <div class="p-2 bg-green-50 dark:bg-green-900/20 rounded font-mono">LEN(D1) - 字符長度</div>
                                <div class="p-2 bg-green-50 dark:bg-green-900/20 rounded font-mono">FIND("@",E1) - 查找位置</div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-purple-600 dark:text-purple-400 mb-4 text-lg">📊 統計函數</h4>
                            <div class="space-y-2 text-sm">
                                <div class="p-2 bg-purple-50 dark:bg-purple-900/20 rounded font-mono">COUNT(A1:A10) - 數字計數</div>
                                <div class="p-2 bg-purple-50 dark:bg-purple-900/20 rounded font-mono">COUNTIF(C1:C10,">5") - 條件計數</div>
                                <div class="p-2 bg-purple-50 dark:bg-purple-900/20 rounded font-mono">SUMIF(D:D,">=30",E:E) - 條件求和</div>
                                <div class="p-2 bg-purple-50 dark:bg-purple-900/20 rounded font-mono">RANK(F1,F:F,0) - 排名</div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md col-span-full">
                            <h4 class="font-semibold text-indigo-600 dark:text-indigo-400 mb-4 text-lg">🔍 查找函數</h4>
                            <div class="space-y-2 text-sm">
                                <div class="p-2 bg-indigo-50 dark:bg-indigo-900/20 rounded font-mono">XLOOKUP(A1,B:B,C:C) - 查找對應值</div>
                                <div class="p-2 bg-indigo-50 dark:bg-indigo-900/20 rounded text-xs text-gray-600 dark:text-gray-400">
                                    ⚠️ 注意：DSE已不考VLOOKUP和HLOOKUP，改為XLOOKUP
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- IF公式生成 -->
                <div>
                    <h3 class="text-2xl font-semibold mb-6 text-orange-600 dark:text-orange-400">🔧 實用工具</h3>
                    <div class="max-w-2xl mx-auto">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-green-600 dark:text-green-400 mb-4 text-lg">IF公式生成</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">條件儲存格：</label>
                                    <input id="conditionCell" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="例如：A1">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">比較符號：</label>
                                    <select id="operatorSelect" class="w-full p-3 border rounded-lg text-base">
                                        <option value=">">&gt; 大於</option>
                                        <option value="<">&lt; 小於</option>
                                        <option value=">=">&gt;= 大於等於</option>
                                        <option value="<=">&lt;= 小於等於</option>
                                        <option value="=">=等於</option>
                                        <option value="<>">&lt;&gt; 不等於</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">比較值：</label>
                                    <input id="valueInput" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="例如：60">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">真值結果：</label>
                                        <input id="trueResult" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="Pass">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">假值結果：</label>
                                        <input id="falseResult" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="Fail">
                                    </div>
                                </div>
                                <button onclick="buildConditionFormula()" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200">
                                    生成IF公式
                                </button>
                                <div id="conditionResult" class="hidden p-4 rounded-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- References Section -->
        <section id="references" class="section hidden">
            <div class="bg-gradient-to-br from-pink-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 md:p-8 shadow-lg">
                <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">🔗 儲存格參照</h2>
                
                <!-- 參照類型 -->
                <div class="mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-pink-600 dark:text-pink-400">📍 參照類型</h3>
                    <div class="grid lg:grid-cols-3 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-blue-500">
                            <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-4 text-lg">相對參照</h4>
                            <div class="space-y-3 text-sm">
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
                                    <strong>格式：</strong> A1, B2, C3
                                </div>
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
                                    <strong>特點：</strong> 複製時自動調整位置
                                </div>
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded font-mono text-xs">
                                    F2: =B2*C2<br>
                                    複製到F3: =B3*C3<br>
                                    複製到F4: =B4*C4
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-green-500">
                            <h4 class="font-semibold text-green-600 dark:text-green-400 mb-4 text-lg">絕對參照</h4>
                            <div class="space-y-3 text-sm">
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded">
                                    <strong>格式：</strong> $A$1, $B$2, $C$3
                                </div>
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded">
                                    <strong>特點：</strong> 複製時位置保持不變
                                </div>
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded font-mono text-xs">
                                    F2: =B2*$D$1<br>
                                    複製到F3: =B3*$D$1<br>
                                    複製到F4: =B4*$D$1
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-purple-500">
                            <h4 class="font-semibold text-purple-600 dark:text-purple-400 mb-4 text-lg">混合參照</h4>
                            <div class="space-y-3 text-sm">
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded">
                                    <strong>格式：</strong> $A1, A$1
                                </div>
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded">
                                    <strong>特點：</strong> 部分固定，部分相對
                                </div>
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded font-mono text-xs">
                                    C2: =$B2*C$1<br>
                                    複製到D3: =$B3*D$1<br>
                                    (欄B固定，列1固定)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 參照示例 -->
                <div class="mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-purple-600 dark:text-purple-400">💡 實用示例</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-orange-600 dark:text-orange-400 mb-4 text-lg">乘數表範例</h4>
                            <div class="space-y-4">
                                <p class="text-sm text-gray-700 dark:text-gray-300">
                                    製作9x9乘數表，B2公式應該如何設計才能正確複製到整個表格？
                                </p>
                                <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded">
                                    <div class="text-xs font-mono mb-2">
                                        <div class="grid grid-cols-4 gap-1">
                                            <div class="bg-gray-200 p-1 text-center"></div>
                                            <div class="bg-gray-200 p-1 text-center">1</div>
                                            <div class="bg-gray-200 p-1 text-center">2</div>
                                            <div class="bg-gray-200 p-1 text-center">3</div>
                                            <div class="bg-gray-200 p-1 text-center">1</div>
                                            <div class="bg-blue-100 p-1 text-center">1</div>
                                            <div class="bg-white p-1 text-center">2</div>
                                            <div class="bg-white p-1 text-center">3</div>
                                            <div class="bg-gray-200 p-1 text-center">2</div>
                                            <div class="bg-white p-1 text-center">2</div>
                                            <div class="bg-white p-1 text-center">4</div>
                                            <div class="bg-white p-1 text-center">6</div>
                                        </div>
                                    </div>
                                    <strong>正確公式：</strong> =$A2*B$1<br>
                                    <small>列($A2)和欄(B$1)分別固定</small>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-indigo-600 dark:text-indigo-400 mb-4 text-lg">查找表範例</h4>
                            <div class="space-y-4">
                                <p class="text-sm text-gray-700 dark:text-gray-300">
                                    使用XLOOKUP查找學生成績等級，查找表位置應如何參照？
                                </p>
                                <div class="bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded">
                                    <strong>正確公式：</strong><br>
                                    <code class="text-xs">
                                        =XLOOKUP(B2,$E$2:$E$5,$F$2:$F$5)
                                    </code><br>
                                    <small>查找範圍和返回範圍都使用絕對參照，確保複製時不變</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 參照轉換器 -->
                <div>
                    <h3 class="text-2xl font-semibold mb-6 text-pink-600 dark:text-pink-400">🔄 實用工具</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-4 text-lg">參照轉換器</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">輸入儲存格參照：</label>
                                    <input id="referenceInput" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="例如：A1, $A$1, $A1, A$1">
                                </div>
                                <div class="grid grid-cols-3 gap-2">
                                    <button onclick="convertReference('relative')" class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm">相對</button>
                                    <button onclick="convertReference('absolute')" class="px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200 text-sm">絕對</button>
                                    <button onclick="convertReference('mixed')" class="px-3 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors duration-200 text-sm">混合</button>
                                </div>
                                <div id="referenceResult" class="hidden p-4 rounded-lg"></div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-green-600 dark:text-green-400 mb-4 text-lg">複製效果模擬器</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">原始公式：</label>
                                    <input id="originalFormula" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="例如：=A1+$B$2">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">原始位置：</label>
                                    <input id="originalPosition" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="例如：C1">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">目標位置：</label>
                                    <input id="targetPosition" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="例如：D3">
                                </div>
                                <button onclick="simulateCopy()" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200">
                                    模擬複製
                                </button>
                                <div id="copyResult" class="hidden p-4 rounded-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Data Manipulation Section -->
        <section id="datamanip" class="section hidden">
            <div class="bg-gradient-to-br from-indigo-50 to-cyan-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 md:p-8 shadow-lg">
                <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">📊 數據處理</h2>
                
                <!-- 篩選與排序 -->
                <div class="mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-600 dark:text-indigo-400">🔍 篩選與排序</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-blue-500">
                            <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-4 text-lg">篩選功能</h4>
                            <div class="space-y-4">
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
                                    <strong>目的：</strong>暫時隱藏不符合條件的數據，只顯示符合準則的記錄
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div><strong>• 自動篩選：</strong>為每欄添加下拉選單</div>
                                    <div><strong>• 自訂篩選：</strong>設定複雜條件</div>
                                    <div><strong>• 進階篩選：</strong>使用條件範圍</div>
                                </div>
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded border-l-4 border-yellow-500">
                                    <strong>注意：</strong>篩選只是隱藏數據，不會刪除原始資料
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-green-500">
                            <h4 class="font-semibold text-green-600 dark:text-green-400 mb-4 text-lg">排序功能</h4>
                            <div class="space-y-4">
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded">
                                    <strong>目的：</strong>重新排列數據順序，便於分析和查找
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div><strong>• 遞升排序：</strong>由小到大，A到Z</div>
                                    <div><strong>• 遞降排序：</strong>由大到小，Z到A</div>
                                    <div><strong>• 多層級排序：</strong>主要條件+次要條件</div>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded">
                                    <strong>自訂排序步驟：</strong><br>
                                    1. 選擇排序範圍<br>
                                    2. 設定排序條件<br>
                                    3. 選擇排序方向
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 數據分析工具 -->
                <div class="mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-cyan-600 dark:text-cyan-400">🔬 數據分析工具</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-purple-600 dark:text-purple-400 mb-4 text-lg">模擬分析</h4>
                            <div class="space-y-4">
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded">
                                    <strong>分析藍本管理員：</strong><br>
                                    設定不同的輸入值組合，觀察結果變化
                                </div>
                                <div class="p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded">
                                    <strong>目標搜尋：</strong><br>
                                    設定目標值，自動尋找需要的輸入值
                                </div>
                                <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded border-l-4 border-blue-500">
                                    <strong>應用場景：</strong><br>
                                    • 財務預測<br>
                                    • 銷售分析<br>
                                    • 成本估算
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-orange-600 dark:text-orange-400 mb-4 text-lg">樞紐分析表</h4>
                            <div class="space-y-4">
                                <div class="p-3 bg-orange-50 dark:bg-orange-900/20 rounded">
                                    <strong>功能：</strong>從大型數據集中提取、組織和匯總資訊
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div><strong>• 列欄位：</strong>縱向分組依據</div>
                                    <div><strong>• 欄欄位：</strong>橫向分組依據</div>
                                    <div><strong>• 數值欄位：</strong>要計算的數據</div>
                                    <div><strong>• 篩選欄位：</strong>限制顯示的數據</div>
                                </div>
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded border-l-4 border-yellow-500">
                                    <strong>優勢：</strong>無需複雜公式即可進行數據匯總分析
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 實用工具 -->
                <div>
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-600 dark:text-indigo-400">🛠️ 實用工具</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-4 text-lg">排序順序預測器</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">輸入數據（用逗號分隔）：</label>
                                    <input id="sortData" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="例如：85,92,78,95,88">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <button onclick="sortData('asc')" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200">遞升排序</button>
                                    <button onclick="sortData('desc')" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors duration-200">遞降排序</button>
                                </div>
                                <div id="sortResult" class="hidden p-4 rounded-lg"></div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-green-600 dark:text-green-400 mb-4 text-lg">樞紐分析使用場景判斷</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">選擇應用場景：</label>
                                    <select id="scenarioSelect" class="w-full p-3 border rounded-lg text-base">
                                        <option value="">選擇場景...</option>
                                        <option value="sales">分析不同地區的銷售情況</option>
                                        <option value="grades">統計各班級的成績分佈</option>
                                        <option value="inventory">查看不同類型商品的庫存</option>
                                        <option value="expenses">比較各部門的支出情況</option>
                                        <option value="forecast">預測未來銷售趨勢</option>
                                        <option value="calculation">計算複雜的數學公式</option>
                                    </select>
                                </div>
                                <button onclick="analyzeScenario()" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200">
                                    分析使用建議
                                </button>
                                <div id="scenarioResult" class="hidden p-4 rounded-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section id="charts" class="section hidden">
            <div class="bg-gradient-to-br from-red-50 to-pink-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 md:p-8 shadow-lg">
                <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">📈 圖表與分析</h2>
                
                <!-- 圖表類型 -->
                <div class="mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-red-600 dark:text-red-400">📊 圖表類型</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="space-y-6">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-blue-500">
                                <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-3 text-lg">📊 直條圖/棒形圖</h4>
                                <div class="space-y-3 text-sm">
                                    <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
                                        <strong>特點：</strong>使用長條形表示數據，長度與數值成正比
                                    </div>
                                    <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
                                        <strong>適用：</strong>比較不同類別的數據大小
                                    </div>
                                    <div class="space-y-1">
                                        <div><strong>• 群組直條圖：</strong>直接比較多個數列</div>
                                        <div><strong>• 堆疊直條圖：</strong>顯示各部分對總和的貢獻</div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-green-500">
                                <h4 class="font-semibold text-green-600 dark:text-green-400 mb-3 text-lg">📈 折線圖</h4>
                                <div class="space-y-3 text-sm">
                                    <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded">
                                        <strong>特點：</strong>使用線條連接數據點，顯示趨勢變化
                                    </div>
                                    <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded">
                                        <strong>適用：</strong>表示連續數據和時間序列變化
                                    </div>
                                    <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded">
                                        <strong>優勢：</strong>清楚顯示數據趨勢和變化模式
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-purple-500">
                                <h4 class="font-semibold text-purple-600 dark:text-purple-400 mb-3 text-lg">🍰 圓形圖</h4>
                                <div class="space-y-3 text-sm">
                                    <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded">
                                        <strong>特點：</strong>將圓形分割為扇形，角度與數值成正比
                                    </div>
                                    <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded">
                                        <strong>適用：</strong>顯示各部分佔整體的比例
                                    </div>
                                    <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded">
                                        <strong>限制：</strong>不適合太多類別或數值接近的數據
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-orange-500">
                                <h4 class="font-semibold text-orange-600 dark:text-orange-400 mb-3 text-lg">📊 其他圖表</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="p-2 bg-orange-50 dark:bg-orange-900/20 rounded">
                                        <strong>散點圖：</strong>顯示兩變數間的相關性
                                    </div>
                                    <div class="p-2 bg-orange-50 dark:bg-orange-900/20 rounded">
                                        <strong>面積圖：</strong>強調數量隨時間的變化
                                    </div>
                                    <div class="p-2 bg-orange-50 dark:bg-orange-900/20 rounded">
                                        <strong>雷達圖：</strong>比較多個項目的多項指標
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 圖表設計原則 -->
                <div class="mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-pink-600 dark:text-pink-400">🎨 圖表設計原則</h3>
                    <div class="grid lg:grid-cols-3 gap-6">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-4">📝 清晰性</h4>
                            <ul class="space-y-2 text-sm">
                                <li>• 標題簡潔明確</li>
                                <li>• 軸標籤清楚</li>
                                <li>• 圖例位置適當</li>
                                <li>• 避免過度裝飾</li>
                            </ul>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-green-600 dark:text-green-400 mb-4">🎯 準確性</h4>
                            <ul class="space-y-2 text-sm">
                                <li>• 比例尺度正確</li>
                                <li>• 數據範圍適當</li>
                                <li>• 避免誤導性視覺</li>
                                <li>• 數據來源可靠</li>
                            </ul>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-purple-600 dark:text-purple-400 mb-4">👁️ 易讀性</h4>
                            <ul class="space-y-2 text-sm">
                                <li>• 顏色搭配協調</li>
                                <li>• 字體大小適中</li>
                                <li>• 對比度足夠</li>
                                <li>• 排版整齊</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 互動工具 -->
                <div>
                    <h3 class="text-2xl font-semibold mb-6 text-red-600 dark:text-red-400">🛠️ 互動工具</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-blue-600 dark:text-blue-400 mb-4 text-lg">圖表類型選擇器</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">數據類型：</label>
                                    <select id="dataType" class="w-full p-3 border rounded-lg text-base">
                                        <option value="">選擇數據類型...</option>
                                        <option value="categorical">分類數據</option>
                                        <option value="continuous">連續數據</option>
                                        <option value="proportion">比例數據</option>
                                        <option value="relationship">關係數據</option>
                                        <option value="time-series">時間序列</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">分析目的：</label>
                                    <select id="analysisGoal" class="w-full p-3 border rounded-lg text-base">
                                        <option value="">選擇分析目的...</option>
                                        <option value="compare">比較大小</option>
                                        <option value="trend">顯示趨勢</option>
                                        <option value="proportion">顯示比例</option>
                                        <option value="distribution">顯示分佈</option>
                                        <option value="correlation">顯示相關性</option>
                                    </select>
                                </div>
                                <button onclick="recommendChart()" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200">
                                    推薦圖表類型
                                </button>
                                <div id="chartRecommendation" class="hidden p-4 rounded-lg"></div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                            <h4 class="font-semibold text-green-600 dark:text-green-400 mb-4 text-lg">簡易數據視覺化</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">輸入數據（用逗號分隔）：</label>
                                    <input id="chartData" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="例如：10,25,30,15,20">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">標籤（用逗號分隔）：</label>
                                    <input id="chartLabels" type="text" class="w-full p-3 border rounded-lg text-base" placeholder="例如：A組,B組,C組,D組,E組">
                                </div>
                                <div class="grid grid-cols-3 gap-2">
                                    <button onclick="createChart('bar')" class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm">直條圖</button>
                                    <button onclick="createChart('line')" class="px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200 text-sm">折線圖</button>
                                    <button onclick="createChart('pie')" class="px-3 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors duration-200 text-sm">圓形圖</button>
                                </div>
                                <div id="chartDisplay" class="hidden p-4 rounded-lg bg-gray-50 dark:bg-gray-700 min-h-[200px] flex items-center justify-center"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="quiz" class="section hidden">
            <div class="bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 md:p-8 shadow-lg">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center">🧩 互動測驗</h2>
                
                <div class="mb-6 text-center">
                    <div class="inline-flex items-center space-x-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
                        <div>
                            <span class="text-sm text-gray-600 dark:text-gray-400">進度：</span>
                            <span id="quizProgress" class="font-semibold">0/15</span>
                        </div>
                        <div>
                            <span class="text-sm text-gray-600 dark:text-gray-400">分數：</span>
                            <span id="quizScore" class="font-semibold text-green-600 dark:text-green-400">0</span>
                        </div>
                    </div>
                </div>
                
                <div id="quizContainer" class="max-w-4xl mx-auto">
                    <div id="quizCard" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 md:p-8">
                        <div id="questionContainer">
                            <!-- Questions will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-6">
                    <button id="startQuizBtn" onclick="startQuiz()" class="px-8 py-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white font-semibold rounded-lg shadow-lg hover:from-purple-600 hover:to-blue-600 transition-all duration-300 transform hover:scale-105">
                        開始測驗
                    </button>
                    <button id="nextQuestionBtn" onclick="nextQuestion()" class="hidden px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors duration-200">
                        下一題
                    </button>
                    <button id="restartQuizBtn" onclick="restartQuiz()" class="hidden px-6 py-3 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors duration-200">
                        重新開始
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 dark:bg-gray-900 text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2024 新界喇沙中學 資訊及通訊科技科</p>
            <p class="text-sm text-gray-400 mt-2">互動學習平台 - 試算表</p>
        </div>
    </footer>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Navigation functionality
        let currentSection = 'overview';
        
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            
            // Show selected section
            document.getElementById(section).classList.remove('hidden');
            document.getElementById(section).classList.add('fade-in');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-purple-100', 'dark:bg-purple-900', 'text-purple-700', 'dark:text-purple-300');
            });
            event.target.classList.add('bg-purple-100', 'dark:bg-purple-900', 'text-purple-700', 'dark:text-purple-300');
            
            currentSection = section;
            updateProgress();
        }

        function updateProgress() {
            const sections = ['overview', 'basics', 'formulas', 'references', 'datamanip', 'charts', 'quiz'];
            const currentIndex = sections.indexOf(currentSection);
            const progress = ((currentIndex + 1) / sections.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Cell selection functionality
        function selectCell(element, address) {
            // Remove previous selection
            document.querySelectorAll('.cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            // Add selection to current cell
            element.classList.add('selected');
            
            // Update display
            document.getElementById('selectedCell').textContent = address;
        }

        // Format detection
        function detectFormat() {
            const input = document.getElementById('formatInput').value.trim();
            if (!input) {
                showResult('formatResult', '請輸入數值', 'error');
                return;
            }

            let format = '';
            let explanation = '';

            if (/^0+\d+$/.test(input)) {
                format = '文字格式';
                explanation = '保留前導零，適合編號或代碼';
            } else if (/^\d+\.\d+$/.test(input)) {
                format = '數值格式';
                explanation = '標準數字，可進行數學運算';
            } else if (/^\d+\/\d+$/.test(input)) {
                format = '日期格式';
                explanation = '日期數據，可進行時間計算';
            } else if (/^\d+%$/.test(input)) {
                format = '百分比格式';
                explanation = '百分比表示，自動除以100';
            } else if (/^\$\d+/.test(input)) {
                format = '貨幣格式';
                explanation = '貨幣數值，含符號和千位分隔符';
            } else if (isNaN(input)) {
                format = '文字格式';
                explanation = '純文字內容，不能進行數學運算';
            } else {
                format = '通用格式';
                explanation = '自動判斷的格式';
            }

            showResult('formatResult', `格式類型：<strong>${format}</strong><br>說明：${explanation}`, 'info');
        }

        // Formula builder
        function buildFormula() {
            const func = document.getElementById('functionSelect').value;
            const range = document.getElementById('rangeInput').value.trim();

            if (!func || !range) {
                showResult('formulaResult', '請選擇函數和輸入範圍', 'error');
                return;
            }

            const formula = `=${func}(${range})`;
            
            let description = '';
            switch(func) {
                case 'SUM':
                    description = '計算指定範圍內所有數值的總和';
                    break;
                case 'AVERAGE':
                    description = '計算指定範圍內數值的平均值';
                    break;
                case 'MAX':
                    description = '找出指定範圍內的最大值';
                    break;
                case 'MIN':
                    description = '找出指定範圍內的最小值';
                    break;
                case 'COUNT':
                    description = '計算指定範圍內含有數字的儲存格數量';
                    break;
                case 'COUNTIF':
                    description = '計算滿足條件的儲存格數量（需要條件參數）';
                    break;
                case 'SUMIF':
                    description = '將滿足條件的儲存格數值相加（需要條件和求和範圍）';
                    break;
                case 'IF':
                    description = '根據條件返回不同的值（需要條件、真值、假值）';
                    break;
                case 'AND':
                    description = '當所有條件都為真時返回TRUE，否則返回FALSE';
                    break;
                case 'OR':
                    description = '當任一條件為真時返回TRUE，所有條件都為假時返回FALSE';
                    break;
                case 'XLOOKUP':
                    description = '查找並返回對應的值（需要查找值、查找範圍、返回範圍）';
                    break;
                case 'RANK':
                    description = '計算數值在範圍中的排名';
                    break;
                case 'ROUND':
                    description = '將數值四捨五入到指定小數位數（需要數值和小數位數）';
                    break;
                case 'INT':
                    description = '取數值的整數部分';
                    break;
                case 'SQRT':
                    description = '計算數值的平方根';
                    break;
                case 'RAND':
                    description = '生成0到1之間的隨機小數（不需要參數）';
                    break;
                case 'LEFT':
                    description = '從文字左邊取出指定字符數（需要文字和字符數）';
                    break;
                case 'RIGHT':
                    description = '從文字右邊取出指定字符數（需要文字和字符數）';
                    break;
                case 'MID':
                    description = '從文字中間取出指定字符（需要文字、起始位置、字符數）';
                    break;
                case 'LEN':
                    description = '計算文字的字符長度';
                    break;
                case 'FIND':
                    description = '查找子字串在文字中的位置（需要子字串和文字）';
                    break;
                default:
                    description = '請參考DSE函數列表了解詳細用法';
            }

            showResult('formulaResult', `<strong>生成的公式：</strong><br><code class="text-lg">${formula}</code><br><br><strong>功能說明：</strong><br>${description}`, 'success');
        }

        // Condition formula builder
        function buildConditionFormula() {
            const cell = document.getElementById('conditionCell').value.trim();
            const operator = document.getElementById('operatorSelect').value;
            const value = document.getElementById('valueInput').value.trim();
            const trueResult = document.getElementById('trueResult').value.trim();
            const falseResult = document.getElementById('falseResult').value.trim();

            if (!cell || !value || !trueResult || !falseResult) {
                showResult('conditionResult', '請填寫所有欄位', 'error');
                return;
            }

            const formula = `=IF(${cell}${operator}${value},"${trueResult}","${falseResult}")`;
            
            showResult('conditionResult', 
                `<strong>生成的條件公式：</strong><br><code class="text-lg">${formula}</code><br><br>` +
                `<strong>邏輯：</strong><br>如果 ${cell} ${operator} ${value}，則顯示「${trueResult}」，否則顯示「${falseResult}」`, 
                'success');
        }

        // Reference converter
        function convertReference(type) {
            const input = document.getElementById('referenceInput').value.trim().toUpperCase();
            if (!input) {
                showResult('referenceResult', '請輸入儲存格參照', 'error');
                return;
            }

            // Extract column and row
            const match = input.match(/(\$?)([A-Z]+)(\$?)(\d+)/);
            if (!match) {
                showResult('referenceResult', '請輸入有效的儲存格參照（如A1）', 'error');
                return;
            }

            const [, , col, , row] = match;
            let result = '';

            switch(type) {
                case 'relative':
                    result = `${col}${row}`;
                    break;
                case 'absolute':
                    result = `$${col}$${row}`;
                    break;
                case 'mixed':
                    result = `$${col}${row} 或 ${col}$${row}`;
                    break;
            }

            const descriptions = {
                'relative': '相對參照 - 複製時會自動調整位置',
                'absolute': '絕對參照 - 複製時位置保持不變',
                'mixed': '混合參照 - 部分固定，部分相對'
            };

            showResult('referenceResult', `<strong>${result}</strong><br>${descriptions[type]}`, 'success');
        }

        // Copy simulation
        function simulateCopy() {
            const formula = document.getElementById('originalFormula').value.trim();
            const originalPos = document.getElementById('originalPosition').value.trim().toUpperCase();
            const targetPos = document.getElementById('targetPosition').value.trim().toUpperCase();

            if (!formula || !originalPos || !targetPos) {
                showResult('copyResult', '請填寫所有欄位', 'error');
                return;
            }

            // Parse positions
            const parsePosition = (pos) => {
                const match = pos.match(/([A-Z]+)(\d+)/);
                return match ? { col: match[1], row: parseInt(match[2]) } : null;
            };

            const orig = parsePosition(originalPos);
            const target = parsePosition(targetPos);

            if (!orig || !target) {
                showResult('copyResult', '請輸入有效的儲存格位置（如A1）', 'error');
                return;
            }

            const colDiff = target.col.charCodeAt(0) - orig.col.charCodeAt(0);
            const rowDiff = target.row - orig.row;

            // Simulate the copy (simplified)
            let newFormula = formula.replace(/([A-Z]+)(\d+)/g, (match, col, row) => {
                if (match.includes('$')) {
                    return match; // Absolute reference, no change
                }
                const newCol = String.fromCharCode(col.charCodeAt(0) + colDiff);
                const newRow = parseInt(row) + rowDiff;
                return `${newCol}${newRow}`;
            });

            showResult('copyResult', 
                `<strong>原始公式：</strong> ${formula}<br>` +
                `<strong>複製後公式：</strong> ${newFormula}<br>` +
                `<strong>位移：</strong> 欄向右${colDiff}，列向下${rowDiff}`, 
                'success');
        }

        // Sort data
        function sortData(order) {
            const input = document.getElementById('sortData').value.trim();
            if (!input) {
                showResult('sortResult', '請輸入數據', 'error');
                return;
            }

            const data = input.split(',').map(item => {
                const num = parseFloat(item.trim());
                return isNaN(num) ? item.trim() : num;
            });

            const sorted = [...data].sort((a, b) => {
                if (typeof a === 'number' && typeof b === 'number') {
                    return order === 'asc' ? a - b : b - a;
                }
                return order === 'asc' ? 
                    String(a).localeCompare(String(b)) : 
                    String(b).localeCompare(String(a));
            });

            const orderText = order === 'asc' ? '遞升' : '遞降';
            showResult('sortResult', 
                `<strong>原始數據：</strong> ${data.join(', ')}<br>` +
                `<strong>${orderText}排序：</strong> ${sorted.join(', ')}`, 
                'success');
        }

        // Analyze scenario
        function analyzeScenario() {
            const scenario = document.getElementById('scenarioSelect').value;
            if (!scenario) {
                showResult('scenarioResult', '請選擇一個場景', 'error');
                return;
            }

            const recommendations = {
                'sales': {
                    tool: '樞紐分析表',
                    reason: '適合按地區匯總銷售數據，可快速生成地區銷售報表',
                    steps: '設定地區為列、產品為欄、銷售額為數值欄位'
                },
                'grades': {
                    tool: '樞紐分析表',
                    reason: '適合按班級統計成績分佈，可同時分析多個指標',
                    steps: '設定班級為列、科目為欄、成績為數值欄位（可用平均值）'
                },
                'inventory': {
                    tool: '樞紐分析表',
                    reason: '適合按商品類型匯總庫存，便於管理不同類別商品',
                    steps: '設定商品類型為列、倉庫為欄、庫存量為數值欄位'
                },
                'expenses': {
                    tool: '樞紐分析表',
                    reason: '適合按部門統計支出，可比較各部門的開支情況',
                    steps: '設定部門為列、費用類型為欄、金額為數值欄位'
                },
                'forecast': {
                    tool: '模擬分析',
                    reason: '適合預測分析，可建立不同情境來預測趨勢',
                    steps: '使用分析藍本管理員設定不同的假設條件'
                },
                'calculation': {
                    tool: '一般公式',
                    reason: '複雜計算應使用函數和公式，樞紐分析表主要用於數據匯總',
                    steps: '建議使用SUM、AVERAGE等數學函數'
                }
            };

            const rec = recommendations[scenario];
            const isRecommended = rec.tool === '樞紐分析表';
            
            showResult('scenarioResult', 
                `<strong>建議工具：</strong> ${rec.tool}<br>` +
                `<strong>原因：</strong> ${rec.reason}<br>` +
                `<strong>操作建議：</strong> ${rec.steps}<br><br>` +
                `<strong>是否適合樞紐分析表：</strong> <span class="${isRecommended ? 'text-green-600' : 'text-red-600'}">${isRecommended ? '是' : '否'}</span>`, 
                isRecommended ? 'success' : 'info');
        }

        // Chart recommendation
        function recommendChart() {
            const dataType = document.getElementById('dataType').value;
            const goal = document.getElementById('analysisGoal').value;

            if (!dataType || !goal) {
                showResult('chartRecommendation', '請選擇數據類型和分析目的', 'error');
                return;
            }

            const recommendations = {
                'categorical-compare': '直條圖 - 清楚比較不同類別的數值大小',
                'categorical-proportion': '圓形圖 - 顯示各類別佔整體的比例',
                'continuous-trend': '折線圖 - 最適合顯示連續數據的變化趨勢',
                'continuous-distribution': '直方圖 - 顯示數據的分佈情況',
                'time-series-trend': '折線圖 - 時間序列最佳選擇',
                'proportion-proportion': '圓形圖 - 專門用於顯示比例關係',
                'relationship-correlation': '散點圖 - 顯示兩個變數間的相關性'
            };

            const key = `${dataType}-${goal}`;
            const recommendation = recommendations[key] || '建議使用直條圖作為通用選擇';

            showResult('chartRecommendation', 
                `<strong>推薦圖表：</strong> ${recommendation}`, 
                'success');
        }

        // Create simple chart visualization
        function createChart(type) {
            const dataStr = document.getElementById('chartData').value.trim();
            const labelsStr = document.getElementById('chartLabels').value.trim();

            if (!dataStr) {
                showResult('chartDisplay', '請輸入數據', 'error');
                return;
            }

            const data = dataStr.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
            const labels = labelsStr ? labelsStr.split(',').map(x => x.trim()) : data.map((_, i) => `項目${i+1}`);

            const display = document.getElementById('chartDisplay');
            display.innerHTML = '';
            display.classList.remove('hidden');

            if (type === 'bar') {
                // Simple bar chart
                const maxValue = Math.max(...data);
                const chartHTML = data.map((value, i) => {
                    const height = (value / maxValue) * 150;
                    const label = labels[i] || `項目${i+1}`;
                    return `
                        <div class="flex flex-col items-center mx-1">
                            <div class="bg-blue-500 w-8" style="height: ${height}px;"></div>
                            <div class="text-xs mt-1 text-center">${label}</div>
                            <div class="text-xs text-gray-600">${value}</div>
                        </div>
                    `;
                }).join('');
                display.innerHTML = `<div class="flex items-end justify-center space-x-2">${chartHTML}</div>`;
            } else if (type === 'line') {
                // Simple line chart simulation
                display.innerHTML = `
                    <div class="text-center">
                        <div class="text-lg font-semibold mb-2">折線圖</div>
                        <div class="text-sm">數據: ${data.join(' → ')}</div>
                        <div class="text-xs text-gray-600 mt-2">實際應用中會顯示連接的線條圖</div>
                    </div>
                `;
            } else if (type === 'pie') {
                // Simple pie chart simulation
                const total = data.reduce((sum, val) => sum + val, 0);
                const percentages = data.map(val => ((val / total) * 100).toFixed(1));
                const pieHTML = data.map((value, i) => {
                    const label = labels[i] || `項目${i+1}`;
                    return `<div class="text-sm">${label}: ${percentages[i]}% (${value})</div>`;
                }).join('');
                display.innerHTML = `
                    <div class="text-center">
                        <div class="text-lg font-semibold mb-2">圓形圖</div>
                        <div class="space-y-1">${pieHTML}</div>
                    </div>
                `;
            }
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.className = `p-4 rounded-lg ${
                type === 'success' ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : 
                type === 'error' ? 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300' : 
                'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300'
            }`;
            element.innerHTML = message;
            element.classList.remove('hidden');
        }

        // Quiz functionality
        let quizData = [
            {
                question: "試算表中儲存格B4的位址是由什麼組成的？",
                options: ["欄B和列4", "列B和欄4", "第B行和第4列", "第4行和第B列"],
                correct: 0,
                explanation: "儲存格位址由欄位字母（B）和列位數字（4）組合而成。"
            },
            {
                question: "以下哪個數值格式最適合儲存馬拉松選手的號碼布編號（如001, 002, 003）？",
                options: ["數值", "文字", "會計專用", "科學符號"],
                correct: 1,
                explanation: "文字格式可以保留前導零，確保號碼布編號始終為三位數。"
            },
            {
                question: "在Excel中，公式=A1+$B$2複製到儲存格D3時會變成什麼？",
                options: ["=D3+$B$2", "=A1+$B$2", "=D3+$E$5", "=A1+$E$5"],
                correct: 0,
                explanation: "A1是相對參照會變成D3，$B$2是絕對參照保持不變。"
            },
            {
                question: "函數=SUMIF(D:D,\">=\"&30,E:E)的作用是什麼？",
                options: ["計算D欄大於30的儲存格數量", "將D欄中大於等於30的對應E欄數值相加", "找出D欄中大於等於30的最大值", "計算E欄的平均值"],
                correct: 1,
                explanation: "SUMIF函數根據D欄的條件（>=30），將對應的E欄數值相加。"
            },
            {
                question: "以下哪個公式可以產生0到5之間的隨機整數（包含0和5）？",
                options: ["=RAND()*5", "=RAND(0,5)", "=INT(RAND()*6)", "=INT(RAND(5))"],
                correct: 2,
                explanation: "RAND()產生0到1之間的小數，乘以6後用INT取整數部分，可得0到5的整數。"
            },
            {
                question: "IF函數=IF(C10>=5,\"Pass\",\"Fail\")中，當C10=5時結果是什麼？",
                options: ["Pass", "Fail", "Error", "5"],
                correct: 0,
                explanation: "條件C10>=5當C10=5時為真，所以返回\"Pass\"。"
            },
            {
                question: "要檢查儲存格是否為空白，應該使用哪個函數？",
                options: ["ISNUMBER()", "ISTEXT()", "ISBLANK()", "ISERROR()"],
                correct: 2,
                explanation: "ISBLANK()函數專門用來檢查儲存格是否為空白。"
            },
            {
                question: "製作乘數表時，B2的公式應該設定為什麼才能正確複製到整個表格？",
                options: ["=$A2*$B1", "=$A2*B$1", "=A$2*$B1", "=A$2*B$1"],
                correct: 1,
                explanation: "需要固定被乘數的欄($A2)和乘數的列(B$1)，這樣複製時才能正確對應。"
            },
            {
                question: "使用XLOOKUP函數時，查找表範圍應該使用什麼類型的參照？",
                options: ["相對參照", "絕對參照", "混合參照", "外部參照"],
                correct: 1,
                explanation: "查找表範圍應使用絕對參照（如$E$2:$F$5），確保複製公式時查找表位置不變。"
            },
            {
                question: "篩選功能的主要作用是什麼？",
                options: ["刪除不需要的數據", "暫時隱藏不符合條件的數據", "重新排列數據順序", "計算數據總和"],
                correct: 1,
                explanation: "篩選是暫時隱藏不符合條件的數據，不會刪除原始資料。"
            },
            {
                question: "以下哪種情況最適合使用樞紐分析表？",
                options: ["計算複雜的數學公式", "比較不同地區的銷售情況", "預測未來銷售趨勢", "格式化儲存格外觀"],
                correct: 1,
                explanation: "樞紐分析表最適合匯總和分析大量數據，比如按地區統計銷售情況。"
            },
            {
                question: "圓形圖最適合用來表示什麼類型的數據？",
                options: ["時間序列變化", "兩個變數的相關性", "各部分佔整體的比例", "數據的最大值和最小值"],
                correct: 2,
                explanation: "圓形圖通過扇形角度表示各部分佔整體的比例關係。"
            },
            {
                question: "折線圖最適合用來顯示什麼？",
                options: ["分類數據的比較", "數據的比例關係", "連續數據的趨勢變化", "數據的分佈情況"],
                correct: 2,
                explanation: "折線圖通過連接的線條清楚顯示連續數據隨時間的變化趨勢。"
            },
            {
                question: "目標搜尋功能的作用是什麼？",
                options: ["尋找數據中的最大值", "根據目標值自動計算所需的輸入值", "搜尋特定的文字內容", "找出數據中的錯誤"],
                correct: 1,
                explanation: "目標搜尋可以設定一個目標值，Excel會自動計算達到該目標所需的輸入值。"
            },
            {
                question: "凍結窗格功能最常用於什麼情況？",
                options: ["保護工作表不被修改", "固定重要的標題行或列在滾動時可見", "防止意外刪除數據", "限制數據輸入範圍"],
                correct: 1,
                explanation: "凍結窗格可以讓重要的標題行或參考列在滾動大型表格時始終可見。"
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let answered = false;

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            answered = false;
            document.getElementById('startQuizBtn').classList.add('hidden');
            document.getElementById('restartQuizBtn').classList.add('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= quizData.length) {
                showQuizResults();
                return;
            }

            const question = quizData[currentQuestionIndex];
            answered = false;
            
            document.getElementById('questionContainer').innerHTML = `
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">問題 ${currentQuestionIndex + 1}/${quizData.length}</h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-6">${question.question}</p>
                    <div class="space-y-3">
                        ${question.options.map((option, index) => `
                            <button onclick="selectAnswer(${index})" 
                                    class="option-btn w-full text-left p-4 border-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200 border-gray-200 dark:border-gray-600">
                                ${String.fromCharCode(65 + index)}. ${option}
                            </button>
                        `).join('')}
                    </div>
                </div>
                <div id="explanation" class="hidden mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500"></div>
            `;

            updateQuizProgress();
            document.getElementById('nextQuestionBtn').classList.add('hidden');
        }

        function selectAnswer(selectedIndex) {
            if (answered) return;
            
            answered = true;
            const question = quizData[currentQuestionIndex];
            const options = document.querySelectorAll('.option-btn');
            
            options.forEach((btn, index) => {
                if (index === question.correct) {
                    btn.classList.add('border-green-500', 'bg-green-50', 'dark:bg-green-900/20', 'text-green-700', 'dark:text-green-300');
                } else if (index === selectedIndex) {
                    btn.classList.add('border-red-500', 'bg-red-50', 'dark:bg-red-900/20', 'text-red-700', 'dark:text-red-300');
                }
                btn.disabled = true;
                btn.classList.add('cursor-not-allowed');
            });

            if (selectedIndex === question.correct) {
                score++;
                options[selectedIndex].classList.add('pulse-success');
            } else {
                options[selectedIndex].classList.add('pulse-error');
            }

            document.getElementById('explanation').innerHTML = `<strong>解釋：</strong> ${question.explanation}`;
            document.getElementById('explanation').classList.remove('hidden');

            updateQuizProgress();
            document.getElementById('nextQuestionBtn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function showQuizResults() {
            const percentage = Math.round((score / quizData.length) * 100);
            let message, color;
            
            if (percentage >= 80) {
                message = "優秀！";
                color = "text-green-600 dark:text-green-400";
            } else if (percentage >= 60) {
                message = "良好！";
                color = "text-blue-600 dark:text-blue-400";
            } else {
                message = "需要加強！";
                color = "text-orange-600 dark:text-orange-400";
            }

            document.getElementById('questionContainer').innerHTML = `
                <div class="text-center">
                    <div class="text-6xl mb-4">🎉</div>
                    <h3 class="text-2xl font-bold mb-4 ${color}">${message}</h3>
                    <div class="text-xl mb-4">
                        你的分數：<span class="font-bold">${score}/${quizData.length}</span> (${percentage}%)
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-4 mb-6">
                        <div class="bg-gradient-to-r from-purple-500 to-blue-500 h-4 rounded-full transition-all duration-1000" 
                             style="width: ${percentage}%"></div>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400">
                        ${percentage >= 80 ? '恭喜你掌握了試算表的核心概念！' : 
                          percentage >= 60 ? '你對試算表有不錯的理解，可以再復習一下錯誤的部分。' : 
                          '建議你重新學習試算表內容，再次挑戰測驗。'}
                    </p>
                </div>
            `;

            document.getElementById('nextQuestionBtn').classList.add('hidden');
            document.getElementById('restartQuizBtn').classList.remove('hidden');
        }

        function restartQuiz() {
            startQuiz();
        }

        function updateQuizProgress() {
            document.getElementById('quizProgress').textContent = `${currentQuestionIndex + 1}/${quizData.length}`;
            document.getElementById('quizScore').textContent = score;
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
        });
    </script>
</body>
</html>
