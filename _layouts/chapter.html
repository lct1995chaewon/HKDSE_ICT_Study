<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }} | é‡é»æº«ç¿’ç­†è¨˜</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; line-height: 1.75; }
        
        /* é–±è®€é€²åº¦æ¢ */
        #progress-bar { transition: width 0.2s; }

        /* é‡é»è¢å…‰ç­†æ•ˆæœ */
        .highlight { background: linear-gradient(120deg, #dbeafe 0%, #dbeafe 100%); background-repeat: no-repeat; background-size: 100% 40%; background-position: 0 90%; }

        /* æ™‚é–“è»¸æ¨£å¼ */
        .timeline-node::before {
            content: ''; position: absolute; left: 23px; top: 40px; bottom: -20px; width: 2px; background: #e2e8f0; z-index: 0;
        }
        .timeline-node:last-child::before { display: none; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 900: '#1e3a8a' }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-50 text-slate-800">

    {% assign data = site.data[page.data_source] %}

    <nav class="fixed top-0 w-full bg-white border-b border-gray-200 z-50 h-14 flex items-center">
        <div class="container mx-auto px-4 max-w-5xl flex justify-between items-center">
            <a href="{{ site.baseurl }}/" class="flex items-center text-sm font-medium text-slate-500 hover:text-brand-600 transition">
                <i class="ri-arrow-left-line mr-1"></i> è¿”å›ç›®éŒ„
            </a>
            <div class="font-bold text-slate-800">{{ page.chapter_id }} {{ page.title }}</div>
            <div class="text-xs text-slate-400 hidden md:block">æœ€å¾Œä¸€åˆ†é˜æº«ç¿’</div>
        </div>
        <div class="absolute bottom-0 left-0 h-0.5 bg-brand-500" id="progress-bar" style="width: 0%"></div>
    </nav>

    <main class="container mx-auto px-4 max-w-3xl pt-24 pb-32">

        <header class="mb-12 border-b border-gray-200 pb-8">
            <div class="inline-block px-3 py-1 bg-brand-50 text-brand-700 rounded text-xs font-bold mb-4 tracking-wider">
                UNIT {{ page.chapter_id }}
            </div>
            <h1 class="text-4xl font-bold text-slate-900 mb-4">{{ page.title }}</h1>
            <p class="text-xl text-slate-500 leading-relaxed">{{ page.description }}</p>
        </header>

        {% if data.key_points %}
        <section class="mb-16">
            <h2 class="text-lg font-bold flex items-center gap-2 mb-4 text-slate-800">
                <i class="ri-lightbulb-flash-line text-yellow-500"></i> æœ¬èª²é‡é»é€Ÿè¨˜
            </h2>
            <div class="grid gap-4 md:grid-cols-3">
                {% for point in data.key_points %}
                <div class="bg-white border border-gray-200 p-4 rounded-lg shadow-sm hover:border-brand-300 transition">
                    <div class="text-{{ point.color }}-600 mb-2 text-xl">
                        <i class="{{ point.icon }}"></i>
                    </div>
                    <h3 class="font-bold text-slate-900 mb-1">{{ point.title }}</h3>
                    <p class="text-sm text-slate-500 leading-snug">{{ point.desc }}</p>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <section class="prose prose-slate max-w-none mb-16 prose-headings:font-bold prose-a:text-brand-600">
            {{ content }}
        </section>

        {% if data.timeline_stages %}
        <section id="stages" class="mb-16 scroll-mt-20">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-900">é‡é»æµç¨‹æ‹†è§£</h2>
                <span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded">Step by Step</span>
            </div>
            
            <div class="bg-white p-8 rounded-xl border border-gray-200 shadow-sm">
                {% for stage in data.timeline_stages %}
                <div class="relative pl-12 pb-8 timeline-node group">
                    <div class="absolute left-0 top-0 w-12 h-12 bg-slate-50 border-2 border-slate-200 rounded-full flex items-center justify-center text-slate-400 font-bold group-hover:border-brand-500 group-hover:text-brand-600 transition-colors z-10">
                        {{ forloop.index }}
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-slate-900 group-hover:text-brand-600 transition-colors">{{ stage.title }}</h3>
                        <p class="text-slate-600 mt-1">{{ stage.desc }}</p>
                        {% if stage.extra %}
                        <div class="mt-2 text-sm text-slate-500 bg-slate-50 inline-block px-2 py-1 rounded border border-slate-100">
                            ğŸ’¡ {{ stage.extra }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        {% if data.hardware_software_items %}
        <section class="mb-16 scroll-mt-20">
            <h2 class="text-2xl font-bold text-slate-900 mb-6">æ¦‚å¿µé‡æ¸…ï¼šç¡¬ä»¶ vs è»Ÿä»¶</h2>
            <div class="bg-white border border-gray-200 rounded-xl overflow-hidden">
                <div class="grid md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-gray-200">
                    <div class="p-8 text-center bg-slate-50/50">
                        <div id="game-card" class="min-h-[160px] flex flex-col items-center justify-center">
                            </div>
                    </div>
                    <div class="p-8 flex flex-col justify-center space-y-4 text-sm">
                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded bg-blue-100 text-blue-600 flex items-center justify-center shrink-0"><i class="ri-cpu-line"></i></div>
                            <div><strong class="block text-slate-900">ç¡¬ä»¶ (Hardware)</strong><span class="text-slate-500">çœ‹å¾—åˆ°ã€æ‘¸å¾—åˆ°çš„å¯¦é«”è¨­å‚™ã€‚</span></div>
                        </div>
                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"><i class="ri-code-line"></i></div>
                            <div><strong class="block text-slate-900">è»Ÿä»¶ (Software)</strong><span class="text-slate-500">é›»è…¦åŸ·è¡Œçš„æŒ‡ä»¤å’Œç¨‹å¼ã€‚</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        {% if data.quiz_questions %}
        <section id="quiz" class="scroll-mt-20">
            <div class="border-t-4 border-brand-500 bg-white shadow-lg rounded-b-lg p-8 md:p-10">
                <div class="flex justify-between items-end mb-8 border-b border-dashed border-gray-300 pb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-900">å–®å…ƒæ¸¬é©—å·</h2>
                        <p class="text-slate-500 text-sm mt-1">è«‹ç´°å¿ƒé–±è®€é¡Œç›®ä½œç­”</p>
                    </div>
                    <div class="text-right">
                        <span class="block text-xs text-slate-400 uppercase">Score</span>
                        <span class="text-3xl font-mono font-bold text-brand-600" id="scoreDisplay">0</span>
                        <span class="text-slate-400 text-lg">/ {{ data.quiz_questions | size }}</span>
                    </div>
                </div>

                <div id="quiz-container">
                    </div>
            </div>
        </section>
        {% endif %}

    </main>

    <footer class="bg-white border-t border-gray-200 py-12 text-center text-slate-400 text-sm">
        <p>æ–°ç•Œå–‡æ²™ä¸­å­¸ ICT ç§‘çµ„ &copy; 2024</p>
        <p class="mt-2">Designed for Revision</p>
    </footer>

    <script>
        // Progress Bar
        window.onscroll = function() {
            let winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            let height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            let scrolled = (winScroll / height) * 100;
            document.getElementById("progress-bar").style.width = scrolled + "%";
        };

        // Data Injection
        const hsItems = {{ data.hardware_software_items | jsonify }} || [];
        const quizData = {{ data.quiz_questions | jsonify }} || [];

        // Game Logic (Simplified)
        let hsIndex = 0;
        if(hsItems.length > 0) loadHSGame();

        function loadHSGame() {
            if(hsIndex >= hsItems.length) {
                document.getElementById('game-card').innerHTML = `<div class="text-green-600 font-bold text-lg mb-2"><i class="ri-checkbox-circle-line"></i> ç·´ç¿’å®Œæˆ</div><button onclick="hsIndex=0;loadHSGame()" class="text-sm underline text-slate-400">é‡ç½®</button>`;
                return;
            }
            const item = hsItems[hsIndex];
            document.getElementById('game-card').innerHTML = `
                <div class="text-sm text-slate-400 mb-2 uppercase tracking-wider">Question</div>
                <h4 class="text-2xl font-bold text-slate-800 mb-2">${item.text}</h4>
                <p class="text-xs text-slate-500 bg-slate-100 px-2 py-1 rounded mb-6">${item.hint}</p>
                <div class="flex gap-3 w-full">
                    <button onclick="checkHS('hardware')" class="flex-1 py-2 border border-blue-200 text-blue-600 rounded hover:bg-blue-50 font-medium transition">ç¡¬ä»¶</button>
                    <button onclick="checkHS('software')" class="flex-1 py-2 border border-purple-200 text-purple-600 rounded hover:bg-purple-50 font-medium transition">è»Ÿä»¶</button>
                </div>
            `;
        }

        function checkHS(ans) {
            const item = hsItems[hsIndex];
            const isCorrect = ans === item.type;
            const bg = isCorrect ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700';
            const icon = isCorrect ? 'ri-check-line' : 'ri-close-line';
            document.getElementById('game-card').innerHTML = `
                <div class="w-full h-full flex flex-col items-center justify-center ${bg} rounded-lg p-4 animate-pulse">
                    <i class="${icon} text-3xl mb-2"></i>
                    <p class="font-bold">${isCorrect ? 'æ­£ç¢ºï¼' : 'éŒ¯èª¤'}</p>
                    <p class="text-xs mt-1 opacity-80">é€™æ˜¯ ${item.type}</p>
                </div>
            `;
            setTimeout(() => { hsIndex++; loadHSGame(); }, 1000);
        }

        // Quiz Logic (Paper Style)
        let qIndex = 0, score = 0;
        if(quizData.length > 0) loadQuiz();

        function loadQuiz() {
            if(qIndex >= quizData.length) {
                document.getElementById('quiz-container').innerHTML = `
                    <div class="text-center py-12">
                        <h3 class="text-2xl font-bold text-slate-800 mb-2">æ¸¬é©—çµæŸ</h3>
                        <p class="text-slate-500 mb-6">ä½ çš„æœ€çµ‚å¾—åˆ†æ˜¯ ${score}</p>
                        <button onclick="qIndex=0;score=0;document.getElementById('scoreDisplay').innerText='0';loadQuiz()" class="px-6 py-2 bg-brand-600 text-white rounded font-medium hover:bg-brand-700">é‡æ–°æ¸¬é©—</button>
                    </div>`;
                return;
            }
            const q = quizData[qIndex];
            document.getElementById('quiz-container').innerHTML = `
                <div class="fade-in">
                    <h4 class="text-lg font-bold text-slate-900 mb-6 leading-relaxed"><span class="text-brand-500 mr-2">${qIndex+1}.</span>${q.question}</h4>
                    <div class="space-y-3">
                        ${q.options.map((opt,i)=>`
                            <button onclick="checkQuiz(${i})" class="w-full text-left p-3 rounded border border-gray-200 hover:border-brand-500 hover:bg-brand-50 transition flex items-start gap-3 group">
                                <div class="w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center text-xs text-gray-500 group-hover:border-brand-500 group-hover:text-brand-600 shrink-0 mt-0.5">${String.fromCharCode(65+i)}</div>
                                <div class="text-slate-700 group-hover:text-brand-900">${opt}</div>
                            </button>
                        `).join('')}
                    </div>
                    <div id="explanation" class="hidden mt-6 p-4 bg-slate-50 border-l-4 border-brand-500 text-slate-700 text-sm"></div>
                    <button id="nextBtn" onclick="nextQ()" class="hidden mt-6 text-brand-600 font-bold hover:underline flex items-center">ä¸‹ä¸€é¡Œ <i class="ri-arrow-right-line ml-1"></i></button>
                </div>
            `;
        }

        function checkQuiz(idx) {
            const q = quizData[qIndex];
            const isCorrect = idx === q.correct;
            if(isCorrect) { score++; document.getElementById('scoreDisplay').innerText = score; }
            
            const exp = document.getElementById('explanation');
            exp.innerHTML = `<strong class="block text-brand-700 mb-1">è§£æï¼š</strong>${q.explanation}`;
            exp.classList.remove('hidden');
            document.getElementById('nextBtn').classList.remove('hidden');

            // Disable buttons
            const btns = document.querySelectorAll('#quiz-container button:not(#nextBtn)');
            btns.forEach((btn, i) => {
                btn.disabled = true;
                if(i === q.correct) {
                    btn.classList.add('bg-green-50', 'border-green-500');
                    btn.querySelector('div:first-child').classList.add('bg-green-500', 'text-white', 'border-green-500');
                } else if(i === idx && !isCorrect) {
                    btn.classList.add('bg-red-50', 'border-red-500');
                    btn.querySelector('div:first-child').classList.add('bg-red-500', 'text-white', 'border-red-500');
                } else {
                    btn.classList.add('opacity-40');
                }
            });
        }
        function nextQ() { qIndex++; loadQuiz(); }
    </script>
</body>
</html>
